
elasticsearch:
  image: opensearchproject/opensearch:${ES_VERSION}
  env_file: .env
  ports:
    - "9200"
    - "9300"
  environment:
    - discovery.type=single-node
    - "ES_JAVA_OPTS=-Xms${ES_MEMORY} -Xmx${ES_MEMORY}"
    - "OPENSEARCH_INITIAL_ADMIN_PASSWORD=${ES_PASSWORD}"
  ulimits:
    memlock:
      soft: -1
      hard: -1
    nofile:
      soft: 65536
      hard: 65536
  volumes:
    - "./.warp/docker/volumes/elasticsearch/nodes:/usr/share/opensearch/data/nodes"
    - "./.warp/docker/config/opensearch:/usr/share/opensearch/config"
  command: >
    bash -c "
    if ! /usr/share/opensearch/bin/opensearch-plugin list | grep -q 'analysis-phonetic'; then
      /usr/share/opensearch/bin/opensearch-plugin install analysis-phonetic;
    fi &&
    /usr/share/opensearch/bin/opensearch"
  networks:
    - back
